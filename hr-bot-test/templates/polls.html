{% extends "base.html" %}

{% block title %}–û–ø—Ä–æ—Å—ã - SapaHR{% endblock %}

{% block content %}
<div class="polls-page">
    <div class="polls-header">
        <h1>üìä –û–ø—Ä–æ—Å—ã –∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</h1>
        {% if is_admin %}
        <button class="btn-create" onclick="toggleCreatePoll()">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            –°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å
        </button>
        {% endif %}
    </div>

    {% if is_admin %}
    <div id="createPollForm" class="create-poll-form" style="display: none;">
        <div class="form-card">
            <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ–ø—Ä–æ—Å</h2>
            <form method="POST" action="{{ url_for('create_poll') }}">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞</label>
                    <input type="text" name="title" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–ø—Ä–æ—Å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤">
                </div>

                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea name="description" rows="2" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏ –æ–ø—Ä–æ—Å–∞"></textarea>
                </div>

                <div id="questions-container">
                    <div class="question-block" data-question="1">
                        <div class="question-header">
                            <h3>–í–æ–ø—Ä–æ—Å 1</h3>
                            <button type="button" class="btn-remove-question" onclick="removeQuestion(1)" style="display:none;">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </button>
                        </div>
                        <div class="form-group">
                            <label>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</label>
                            <input type="text" name="questions[]" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å">
                        </div>
                        <div class="form-group">
                            <label>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤</label>
                            <textarea name="options[]" rows="4" required placeholder="–í–∞—Ä–∏–∞–Ω—Ç 1&#10;–í–∞—Ä–∏–∞–Ω—Ç 2&#10;–í–∞—Ä–∏–∞–Ω—Ç 3"></textarea>
                            <small>–í–≤–µ–¥–∏—Ç–µ –∫–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏</small>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn-add-question" onclick="addQuestion()">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                </button>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å</button>
                    <button type="button" class="btn-secondary" onclick="toggleCreatePoll()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <div class="polls-management">
        <h2>üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ä–æ—Å–∞–º–∏</h2>
        {% if polls %}
            <div class="polls-grid">
                {% for poll in polls %}
                <div class="poll-manage-card {{ 'active' if poll.is_active else 'inactive' }}">
                    <div class="poll-manage-header">
                        <div>
                            <h3>{{ poll.title or poll.question }}</h3>
                            {% if poll.description %}
                            <p class="poll-description">{{ poll.description }}</p>
                            {% endif %}
                        </div>
                        <span class="poll-badge {{ 'badge-active' if poll.is_active else 'badge-inactive' }}">
                            {{ '–ê–∫—Ç–∏–≤–µ–Ω' if poll.is_active else '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω' }}
                        </span>
                    </div>
                    <div class="poll-manage-stats">
                        <div class="stat-item">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z" stroke="currentColor" stroke-width="1.5"/>
                                <path d="M8 5V8L10 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                            {{ poll.created_at.strftime('%d.%m.%Y') }}
                        </div>
                        <div class="stat-item">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M8 10C10.2091 10 12 8.20914 12 6C12 3.79086 10.2091 2 8 2C5.79086 2 4 3.79086 4 6C4 8.20914 5.79086 10 8 10Z" stroke="currentColor" stroke-width="1.5"/>
                                <path d="M2 14C2 11.7909 4.68629 10 8 10C11.3137 10 14 11.7909 14 14" stroke="currentColor" stroke-width="1.5"/>
                            </svg>
                            {{ poll.total_responses or poll.total_votes or 0 }} –æ—Ç–≤–µ—Ç–æ–≤
                        </div>
                        <div class="stat-item">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M8 2V8M8 8L11 5M8 8L5 5" stroke="currentColor" stroke-width="1.5"/>
                                <path d="M14 11V13C14 13.5523 13.5523 14 13 14H3C2.44772 14 2 13.5523 2 13V11" stroke="currentColor" stroke-width="1.5"/>
                            </svg>
                            {{ poll.questions|length }} –≤–æ–ø—Ä.
                        </div>
                    </div>
                    <div class="poll-manage-actions">
                        {% if poll.is_active %}
                        <form method="POST" action="{{ url_for('deactivate_poll', poll_id=poll.id) }}">
                            <button type="submit" class="btn-action btn-deactivate">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </form>
                        {% else %}
                        <form method="POST" action="{{ url_for('activate_poll', poll_id=poll.id) }}">
                            <button type="submit" class="btn-action btn-activate">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M13 4L6 11L3 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </form>
                        {% endif %}
                        <form method="POST" action="{{ url_for('delete_poll', poll_id=poll.id) }}">
                            <button type="submit" class="btn-action btn-delete" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –æ–ø—Ä–æ—Å?')">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M3 4H13M5 4V3C5 2.44772 5.44772 2 6 2H10C10.5523 2 11 2.44772 11 3V4M6 7V11M10 7V11M4 4H12V13C12 13.5523 11.5523 14 11 14H5C4.44772 14 4 13.5523 4 13V4Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                    <path d="M32 56C45.2548 56 56 45.2548 56 32C56 18.7452 45.2548 8 32 8C18.7452 8 8 18.7452 8 32C8 45.2548 18.7452 56 32 56Z" stroke="#E2E8F0" stroke-width="3"/>
                    <path d="M22 28H42M22 36H34" stroke="#E2E8F0" stroke-width="3" stroke-linecap="round"/>
                </svg>
                <p>–û–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
            </div>
        {% endif %}
    </div>
    {% endif %}

    <div class="active-polls-section">
        <h2>üî• {{ '–í—Å–µ –æ–ø—Ä–æ—Å—ã' if is_admin else '–ê–∫—Ç–∏–≤–Ω—ã–µ –æ–ø—Ä–æ—Å—ã' }}</h2>
        {% if active_polls %}
            <div class="active-polls-grid">
                {% for poll in active_polls %}
                <div class="poll-card-modern">
                    <div class="poll-header">
                        <h3>{{ poll.title or poll.question }}</h3>
                        {% if poll.description %}
                        <p class="poll-desc">{{ poll.description }}</p>
                        {% endif %}
                        <div class="poll-meta">
                            <span class="poll-date">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                    <path d="M7 13C10.3137 13 13 10.3137 13 7C13 3.68629 10.3137 1 7 1C3.68629 1 1 3.68629 1 7C1 10.3137 3.68629 13 7 13Z" stroke="currentColor" stroke-width="1.2"/>
                                    <path d="M7 4V7L9 9" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                                </svg>
                                {{ poll.created_at.strftime('%d.%m.%Y') }}
                            </span>
                            <span class="poll-votes">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                    <path d="M7 9C9.20914 9 11 7.20914 11 5C11 2.79086 9.20914 1 7 1C4.79086 1 3 2.79086 3 5C3 7.20914 4.79086 9 7 9Z" stroke="currentColor" stroke-width="1.2"/>
                                    <path d="M1 13C1 10.7909 3.68629 9 7 9C10.3137 9 13 10.7909 13 13" stroke="currentColor" stroke-width="1.2"/>
                                </svg>
                                {{ poll.total_responses or poll.total_votes or 0 }} –æ—Ç–≤–µ—Ç–æ–≤
                            </span>
                        </div>
                    </div>

                    {% if poll.questions %}
                        {% for question in poll.questions %}
                        <div class="poll-question-block">
                            <h4 class="question-title">{{ loop.index }}. {{ question.question }}</h4>
                            <div class="poll-options-visual">
                                {% set votes_data = question.votes|from_json %}
                                {% set total = question.total_votes if question.total_votes > 0 else 1 %}

                                {% for option in question.options.split(',') %}
                                {% set vote_count = votes_data.get(option.strip(), 0) %}
                                {% set percentage = (vote_count / total * 100)|round(1) %}
                                <div class="poll-option-visual">
                                    <div class="option-info">
                                        <span class="option-label">{{ option.strip() }}</span>
                                        <div class="option-stats">
                                            <span class="option-count">{{ vote_count }}</span>
                                            <span class="option-percent">{{ percentage }}%</span>
                                        </div>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: {{ percentage }}%"></div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    {% endif %}

                    <div class="poll-footer">
                        <div class="poll-status">
                            <span class="status-dot"></span>
                            –ê–∫—Ç–∏–≤–Ω—ã–π –æ–ø—Ä–æ—Å
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                    <path d="M32 56C45.2548 56 56 45.2548 56 32C56 18.7452 45.2548 8 32 8C18.7452 8 8 18.7452 8 32C8 45.2548 18.7452 56 32 56Z" stroke="#E2E8F0" stroke-width="3"/>
                    <path d="M24 26L32 34L40 26M24 34L32 42L40 34" stroke="#E2E8F0" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç</p>
            </div>
        {% endif %}
    </div>
</div>

<style>
.polls-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 24px;
}

.polls-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
}

.polls-header h1 {
    font-size: 28px;
    font-weight: 700;
    color: #1a202c;
    margin: 0;
}

.btn-create {
    display: flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-create:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
}

.create-poll-form {
    margin-bottom: 32px;
}

.form-card {
    background: white;
    border-radius: 16px;
    padding: 32px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.form-card h2 {
    font-size: 22px;
    font-weight: 700;
    color: #1a202c;
    margin: 0 0 24px 0;
}

.question-block {
    background: #f7fafc;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
}

.question-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.question-header h3 {
    font-size: 16px;
    font-weight: 600;
    color: #2d3748;
    margin: 0;
}

.btn-remove-question {
    background: #fed7d7;
    color: #742a2a;
    border: none;
    padding: 8px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-remove-question:hover {
    background: #fc8181;
}

.btn-add-question {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #e6fffa;
    color: #234e52;
    border: 2px dashed #81e6d9;
    padding: 12px 20px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 24px;
    transition: all 0.2s;
}

.btn-add-question:hover {
    background: #b2f5ea;
    border-color: #4fd1c5;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #4a5568;
    font-weight: 600;
    font-size: 14px;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 15px;
    font-family: inherit;
    transition: all 0.2s ease;
    background: white;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #667eea;
}

.form-group small {
    display: block;
    margin-top: 6px;
    color: #718096;
    font-size: 13px;
}

.form-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 28px;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
    background: #f7fafc;
    color: #4a5568;
    border: 2px solid #e2e8f0;
    padding: 12px 28px;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-secondary:hover {
    background: #edf2f7;
    border-color: #cbd5e0;
}

.polls-management {
    margin-bottom: 48px;
}

.polls-management h2 {
    font-size: 20px;
    font-weight: 700;
    color: #1a202c;
    margin: 0 0 20px 0;
}

.polls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
}

.poll-manage-card {
    background: white;
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.poll-manage-card.active {
    border-color: #48bb78;
}

.poll-manage-card.inactive {
    opacity: 0.7;
}

.poll-manage-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.poll-manage-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 16px;
    gap: 12px;
}

.poll-manage-header h3 {
    font-size: 16px;
    font-weight: 600;
    color: #2d3748;
    margin: 0 0 4px 0;
}

.poll-description {
    font-size: 13px;
    color: #718096;
    margin: 0;
}

.poll-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    white-space: nowrap;
}

.badge-active {
    background: #c6f6d5;
    color: #22543d;
}

.badge-inactive {
    background: #fed7d7;
    color: #742a2a;
}

.poll-manage-stats {
    display: flex;
    gap: 16px;
    margin-bottom: 16px;
    padding: 12px;
    background: #f7fafc;
    border-radius: 8px;
    flex-wrap: wrap;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: #718096;
}

.stat-item svg {
    color: #a0aec0;
}

.poll-manage-actions {
    display: flex;
    gap: 8px;
}

.btn-action {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    flex: 1;
    justify-content: center;
}

.btn-activate {
    background: #c6f6d5;
    color: #22543d;
}

.btn-activate:hover {
    background: #9ae6b4;
}

.btn-deactivate {
    background: #feebc8;
    color: #7c2d12;
}

.btn-deactivate:hover {
    background: #fbd38d;
}

.btn-delete {
    background: #fed7d7;
    color: #742a2a;
}

.btn-delete:hover {
    background: #fc8181;
}

.active-polls-section h2 {
    font-size: 20px;
    font-weight: 700;
    color: #1a202c;
    margin: 0 0 20px 0;
}

.active-polls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
    gap: 24px;
}

.poll-card-modern {
    background: white;
    border-radius: 20px;
    padding: 28px;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border: 1px solid #e2e8f0;
}

.poll-card-modern:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
}

.poll-header h3 {
    font-size: 18px;
    font-weight: 700;
    color: #1a202c;
    margin: 0 0 8px 0;
}

.poll-desc {
    font-size: 14px;
    color: #718096;
    margin: 0 0 12px 0;
}

.poll-meta {
    display: flex;
    gap: 16px;
    font-size: 13px;
    color: #718096;
    margin-bottom: 20px;
}

.poll-date,
.poll-votes {
    display: flex;
    align-items: center;
    gap: 6px;
}

.poll-question-block {
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid #e2e8f0;
}

.poll-question-block:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.question-title {
    font-size: 15px;
    font-weight: 600;
    color: #2d3748;
    margin: 0 0 16px 0;
}

.poll-options-visual {
    margin: 16px 0;
}

.poll-option-visual {
    margin-bottom: 16px;
}

.poll-option-visual:last-child {
    margin-bottom: 0;
}

.option-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.option-label {
    font-weight: 600;
    color: #2d3748;
    font-size: 14px;
}

.option-stats {
    display: flex;
    gap: 12px;
    align-items: center;
}

.option-count {
    font-size: 13px;
    color: #718096;
    font-weight: 500;
}

.option-percent {
    font-size: 14px;
    font-weight: 700;
    color: #667eea;
}

.progress-bar {
    height: 10px;
    background: #edf2f7;
    border-radius: 10px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
    transition: width 0.8s ease;
    animation: fillAnimation 0.8s ease;
}

@keyframes fillAnimation {
    from {
        width: 0;
    }
}

.poll-footer {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e2e8f0;
}

.poll-status {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: #718096;
    font-weight: 500;
}

.status-dot {
    width: 8px;
    height: 8px;
    background: #48bb78;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    background: white;
    border-radius: 16px;
    border: 2px dashed #e2e8f0;
}

.empty-state svg {
    margin-bottom: 16px;
}

.empty-state p {
    color: #a0aec0;
    font-size: 16px;
    margin: 0;
}

@media (max-width: 768px) {
    .polls-grid,
    .active-polls-grid {
        grid-template-columns: 1fr;
    }

    .polls-header {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
    }

    .btn-create {
        justify-content: center;
    }
}
</style>

<script>
let questionCount = 1;

function toggleCreatePoll() {
    const form = document.getElementById('createPollForm');
    if (form.style.display === 'none') {
        form.style.display = 'block';
        form.scrollIntoView({ behavior: 'smooth', block: 'start' });
    } else {
        form.style.display = 'none';
    }
}

function addQuestion() {
    questionCount++;
    const container = document.getElementById('questions-container');
    const questionBlock = document.createElement('div');
    questionBlock.className = 'question-block';
    questionBlock.setAttribute('data-question', questionCount);
    questionBlock.innerHTML = `
        <div class="question-header">
            <h3>–í–æ–ø—Ä–æ—Å ${questionCount}</h3>
            <button type="button" class="btn-remove-question" onclick="removeQuestion(${questionCount})">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2"/>
                </svg>
            </button>
        </div>
        <div class="form-group">
            <label>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</label>
            <input type="text" name="questions[]" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å">
        </div>
        <div class="form-group">
            <label>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤</label>
            <textarea name="options[]" rows="4" required placeholder="–í–∞—Ä–∏–∞–Ω—Ç 1&#10;–í–∞—Ä–∏–∞–Ω—Ç 2&#10;–í–∞—Ä–∏–∞–Ω—Ç 3"></textarea>
            <small>–í–≤–µ–¥–∏—Ç–µ –∫–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏</small>
        </div>
    `;
    container.appendChild(questionBlock);

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ
    updateRemoveButtons();
}

function removeQuestion(num) {
    const block = document.querySelector(`[data-question="${num}"]`);
    if (block) {
        block.remove();
        updateQuestionNumbers();
        updateRemoveButtons();
    }
}

function updateQuestionNumbers() {
    const blocks = document.querySelectorAll('.question-block');
    blocks.forEach((block, index) => {
        const h3 = block.querySelector('h3');
        h3.textContent = `–í–æ–ø—Ä–æ—Å ${index + 1}`;
        block.setAttribute('data-question', index + 1);
    });
    questionCount = blocks.length;
}

function updateRemoveButtons() {
    const blocks = document.querySelectorAll('.question-block');
    blocks.forEach((block, index) => {
        const btn = block.querySelector('.btn-remove-question');
        if (blocks.length > 1) {
            btn.style.display = 'block';
        } else {
            btn.style.display = 'none';
        }
    });
}
</script>
{% endblock %}